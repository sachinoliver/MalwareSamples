$code = @"
using System;
using System.Runtime.InteropServices;
public class AmsiTest {
    [DllImport("amsi.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern int AmsiScanBuffer(IntPtr amsiContext, byte[] buffer, uint length, string contentName, IntPtr session, out int result);
    public static void TriggerAmsi() {
        byte[] buffer = System.Text.Encoding.Unicode.GetBytes("Invoke-Mimikatz");
        IntPtr context = IntPtr.Zero;
        IntPtr session = IntPtr.Zero;
        int result;
        AmsiScanBuffer(context, buffer, (uint)buffer.Length, "Invoke-Mimikatz", session, out result);
        Console.WriteLine("AMSI scan result: " + result);
    }
}
"@
Add-Type -TypeDefinition $code
[AmsiTest]::TriggerAmsi()
